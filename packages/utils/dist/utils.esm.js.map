{"version":3,"file":"utils.esm.js","sources":["../src/lazyGetters.ts","../src/createEvent.ts","../src/invariant.ts","../src/memo.ts","../src/warning.ts","../src/computed.ts"],"sourcesContent":["export const lazyGetters = <T extends Record<any, any>>(\n  obj: T,\n  onEvaluated?: (key: keyof T, value: T[keyof T]) => void\n): T => {\n  for (const key in obj) {\n    const descriptor = Object.getOwnPropertyDescriptor(obj, key)\n    if (!descriptor) continue\n    const prevGet = descriptor.get\n\n    if (!prevGet) {\n      onEvaluated?.(key, obj[key])\n      continue\n    }\n\n    if (!descriptor.configurable) continue\n\n    Object.defineProperty(obj, key, {\n      ...descriptor,\n      get() {\n        const value = prevGet()\n        Object.defineProperty(obj, key, {\n          configurable: true,\n          writable: false,\n          enumerable: true,\n          value,\n        })\n\n        onEvaluated?.(key, value)\n        return value\n      },\n    })\n  }\n\n  return obj\n}\n","export const createEvent = <TCallback extends (...args: any[]) => any>() => {\n  return new Event()\n}\n\nexport class Event<TCallback extends (...args: any[]) => any> {\n  listeners = new Set<TCallback>()\n\n  listen(callback: TCallback) {\n    this.listeners.add(callback)\n    return () => this.off(callback)\n  }\n\n  filter(filter: (...parameters: Parameters<TCallback>) => boolean) {\n    const filteredEvent = createEvent<TCallback>()\n\n    this.listen(((...args: Parameters<TCallback>) => {\n      const shouldEmit = filter(...args)\n      if (!shouldEmit) return\n\n      return filteredEvent.emit(...args)\n    }) as TCallback)\n    return filteredEvent\n  }\n\n  then(callback: TCallback) {\n    const listener = ((...args: any[]) => {\n      this.off(listener)\n\n      return callback(...args)\n    }) as TCallback\n\n    return this.listen(listener)\n  }\n\n  off(callback: TCallback) {\n    this.listeners.delete(callback)\n  }\n\n  emit = (...args: Parameters<TCallback>) => {\n    for (const emit of Array.from(this.listeners)) {\n      emit(...args)\n    }\n  }\n}\n","const isProduction: boolean = process.env.NODE_ENV === 'production'\n\nconst prefix = `[gqless] `\n\nexport function invariant(condition: any, message?: string): asserts condition {\n  if (condition) return\n\n  if (isProduction) {\n    throw new Error(\n      prefix +\n        'invariant exception occured! view full message in development mode'\n    )\n  } else {\n    throw new Error(prefix + message)\n  }\n}\n","type Dependency = {\n  weak: WeakMap<any, Dependency>\n  strong: Map<any, Dependency>\n  value?: any\n}\nconst createDependency = (): Dependency => ({\n  weak: new WeakMap(),\n  strong: new Map(),\n})\n\nconst dependencyType = (data: any) =>\n  data && data instanceof Object ? 'weak' : 'strong'\n\n/**\n * Memory-leak free memoization\n */\nexport function createMemo() {\n  const cache: Map<string, Dependency> = new Map()\n\n  const memoKey = (key = 'default') => {\n    if (!cache.has(key)) cache.set(key, createDependency())\n\n    const keyDependency = cache.get(key)!\n\n    /**\n     * Returns the value for the given dependencies,\n     * otherwise undefined\n     */\n    function memo<T = any>(dependencies: any[]): T | undefined\n    /**\n     * Returns the value for the given dependencies,\n     * otherwise function is called and added to cache\n     */\n    function memo<T>(get: () => T, dependencies?: any[]): T\n\n    function memo<T>(\n      getOrDependencies: any[] | (() => T),\n      dependencies: any[] = []\n    ): T | void {\n      const get =\n        typeof getOrDependencies === 'function' ? getOrDependencies : undefined\n      if (!get) dependencies = getOrDependencies as any[]\n\n      let dependency = keyDependency\n      let index = 0\n      const changedDependency = dependencies.find((data, i) => {\n        index = i\n        const type = dependencyType(data)\n        if (!dependency[type].has(data)) return true\n        dependency = dependency[type].get(data)!\n\n        return false\n      })\n\n      if (!changedDependency && 'value' in dependency) return dependency.value\n\n      if (!get) return\n\n      for (let i = index; i < dependencies.length; i++) {\n        const data = dependencies[i]\n        const newDependency = createDependency()\n        dependency[dependencyType(data)].set(data, newDependency)\n        dependency = newDependency\n      }\n\n      const value = get()\n      dependency.value = value\n      return value\n    }\n\n    return memo\n  }\n\n  return new Proxy(memoKey(), {\n    get(_, prop: any) {\n      return memoKey(prop)\n    },\n  }) as ReturnType<typeof memoKey> & Record<string, ReturnType<typeof memoKey>>\n}\n","const isProduction: boolean = process.env.NODE_ENV === 'production'\n\nconst prefix = `[gqless] `\n\nexport function warning(condition: any, message?: string) {\n  if (condition) return\n  if (isProduction) return\n\n  const text = prefix + message\n\n  if (typeof console !== 'undefined') {\n    console.warn(text)\n  }\n\n  // Throwing an error and catching it immediately\n  // to improve debugging\n  // A consumer can use 'pause on caught exceptions'\n  // https://github.com/facebook/react/issues/4216\n  try {\n    throw Error(text)\n  } catch (x) {}\n}\n","export const computed = <T>(\n  target: T,\n  propertyKey: string,\n  descriptor: PropertyDescriptor\n) => {\n  const getValue = descriptor.get\n\n  descriptor.get = function(this: any) {\n    const value = getValue?.call(this)\n    Object.defineProperty(this, propertyKey, {\n      enumerable: true,\n      value,\n    })\n    return value\n  }\n}\n"],"names":["lazyGetters","obj","onEvaluated","key","descriptor","Object","getOwnPropertyDescriptor","prevGet","get","configurable","defineProperty","value","writable","enumerable","createEvent","Event","constructor","Set","args","emit","Array","from","listeners","listen","callback","add","off","filter","filteredEvent","shouldEmit","then","listener","delete","isProduction","process","env","NODE_ENV","prefix","invariant","condition","message","Error","createDependency","weak","WeakMap","strong","Map","dependencyType","data","createMemo","cache","memoKey","has","set","keyDependency","memo","getOrDependencies","dependencies","undefined","dependency","index","changedDependency","find","i","type","length","newDependency","Proxy","_","prop","warning","text","console","warn","x","computed","target","propertyKey","getValue","call"],"mappings":"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"}